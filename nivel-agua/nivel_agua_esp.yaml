esphome:
  name: nivelagua         # ğŸ”§ Nombre del dispositivo (sin espacios ni acentos)
  friendly_name: "Nivel de agua ESP"  # ğŸ·ï¸ Nombre descriptivo para Home Assistant

esp32:
  board: esp32dev         # ğŸ§  Tipo de placa (no cambiar si usas una ESP32 genÃ©rica)

wifi:
  ssid: "TUNOMBREDEWIFI"       # ğŸ“¶ Reemplaza con el nombre de tu red Wi-Fi
  password: "TUPASSWORD"       # ğŸ” Reemplaza con la contraseÃ±a de tu red

  manual_ip:                  # ğŸŒ Configura una IP estÃ¡tica si lo deseas (recomendado)
    static_ip: 192.168.X.XXX  # ğŸ‘‰ Sustituye con una IP libre dentro de tu red local
    gateway: 192.168.X.1       # DirecciÃ³n del router (generalmente termina en .1)
    subnet: 255.255.255.0      # No suele cambiar

logger:                        # ğŸ“ Activa los mensajes de diagnÃ³stico por red (no modificar)

api:                           # ğŸ¤ Permite que Home Assistant se conecte al ESP32
  password: ""                 # ğŸ”‘ Puedes dejarlo vacÃ­o o poner una clave para mayor seguridad

sensor:
  # SENSOR 1 â€“ Voltaje crudo leÃ­do desde la boya resistiva
  - platform: adc
    pin: GPIO34                  # ğŸ“ Pin analÃ³gico del ESP32 conectado al divisor de tensiÃ³n
    name: "voltaje boya"
    id: voltaje_boya
    attenuation: 12db            # ğŸšï¸ Configura el rango de lectura del ADC (12â€¯dB = mÃ¡x. 3.3â€¯V)
    update_interval: 5s          # â±ï¸ Cada cuÃ¡ntos segundos se hace una mediciÃ³n
    accuracy_decimals: 2         # ğŸ” Solo muestra 2 decimales para evitar ruido excesivo
    filters:
      - exponential_moving_average:
          alpha: 0.05            # ğŸ“Š Suaviza variaciones rÃ¡pidas para una lectura mÃ¡s estable
          send_every: 1

  # SENSOR 2 â€“ Porcentaje de agua calculado linealmente a partir del voltaje
  - platform: template
    name: "nivel de agua ESP"
    update_interval: 5s
    unit_of_measurement: "%"
    accuracy_decimals: 1
    lambda: |-
      // Leer el voltaje actual, redondear a 2 decimales
      float v = round(id(voltaje_boya).state * 100.0f) / 100.0f;
      float porcentaje = 0.0f;

      // Ajustar aquÃ­ el valor mÃ¡ximo de voltaje segÃºn la resistencia y boya usada
      float voltaje_maximo = 1.58f; // ğŸ” CAMBIAR si en tu boya el mÃ¡ximo es distinto

      // Calcular porcentaje lineal entre 0 V (0%) y voltaje_maximo (100%)
      porcentaje = (v / voltaje_maximo) * 100.0f;

      // Limitar el resultado a entre 0% y 100%
      porcentaje = std::min(std::max(porcentaje, 0.0f), 100.0f);

      // Mostrar en logs de Home Assistant
      ESP_LOGD("custom", "Voltaje leÃ­do: %.2f V â†’ %.1f %%", v, porcentaje);
      return porcentaje;

